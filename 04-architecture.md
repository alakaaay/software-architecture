# 4. Концептуальная архитектура
Система разделена по модулям  согласно основным бизнес функциям
![Схема архитектуры](images/architecture.png)

## 1. Авторизация и управление доступом
- **Отвечает за:** аутентификацию, авторизацию, управление ролями и сессиями.  
- **Функции:** 
  - Логин/регистрация (email, соцсети, Passkeys)  
  - refresh токены  
  - Управление согласиями (consents)  
  - Соцлогины (Apple, Google)  
- **БД:** встроенная Keycloak DB (PostgreSQL), хранение сессий и ключей.

## 2. Клиенты
- **Отвечает за:** хранение данных о пользователях и настройках.  
- **Функции:** 
  - CRUD профиля  
  - Приватность (public/private поля)  
  - Настройки и предпочтения  
  - Аватары, медиа профиля  
- **БД:** PostgreSQL (профили), S3 (аватары, фото), Redis (кэш профилей).

## 3. Социализация
- **Отвечает за:** социальные связи и взаимодействие.  
- **Функции:**  
  - Дружба, подписки, группы по интересам  
  - Посты, комментарии, лайки  
  - Лента активности  
  - Жалобы/модерация контента  
- **БД:** PostgreSQL (граф связей, посты), Elasticsearch/OpenSearch (поиск по людям/группам), Redis (кэш ленты).

## Уведомления
- **Отвечает за:** доставку событий пользователям.  
- **Функции:**  
  - Push-уведомления  
  - Email, inbox-сообщения  
- **БД:** PostgreSQL (лог уведомлений), Redis Streams (очередь доставки).

## 5. Акции и контент
- **Отвечает за:** управление новостями и промоакциями.  
- **Функции:**  
  - Региональные и персональные промо  
  - Новости, статьи, контент  
  - Интеграция с e-commerce (deeplink на товары)  
- **БД:** PostgreSQL (правила таргетинга), Headless CMS (контент), CDN/S3 (медиа).

## 6. Геймификация
- **Отвечает за:** игровые механики, челленджи, бейджи.  
- **Функции:**  
  - Начисление очков и бейджей  
  - Лидборды (региональные, групповые)  
  - Управление челленджами  
- **БД:** PostgreSQL (история наград), Redis Sorted Sets (рейтинги), Kafka (события активности).


## 7. Тренировки
- **Отвечает за:** управление тренировками и телеметрией.  
- **Функции:**  
  - Запись тренировок (старт/пауза/стоп)  
  - Импорт данных (HealthKit, Google Fit, Strava)  
  - Аналитика тренировок и сравнение с прошлыми  
  - Генерация планов тренировок  
- **БД:** PostgreSQL (метаданные), TimescaleDB/ClickHouse (телеметрия, временные ряды), S3 (файлы маршрутов, медиа).


## 8. Устройства
- **Отвечает за:** подключение внешних сенсоров и фитнес-платформ.  
- **Функции:**  
  - Интеграция с устройствами  
  - Интеграция со Strava/Garmin/Polar  
  - Обработка OAuth токенов сторонних сервисов  
  - Валидация и нормализация данных  
- **БД:** PostgreSQL (учёт интеграций), Redis (сессии устройств).
